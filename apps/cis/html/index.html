<!DOCTYPE html>
<html xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta charset="utf-8">
  <title>DCAPE CIS</title>

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">
  <script src="services.json" type="text/javascript"></script>

</head>
<body>
  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="column" style="margin-top: 5%">
        <h4>Welcome to <a href="https://github.com/dopos/dcape">DCAPE</a> Continuous Integration Server</h4>
        <p>Our resources:
          <ul>
            <li><a href="/logs/" target="_blank">Application logs</a>
            <li><a href="/conf/rpc/tag" target="_blank">Config store</a>
            <li><a href="/dashboard/" target="_blank">Traefik dashboard</a>
            <li><a href="/hook.pub">Hook public key</a> (for use in <a href="http://gogs.io">Gogs</a> remove last CR)</li>
          </ul>
        </p>
        <p>Hosted projects:
          <ul id='sites'>
          </ul>
        </p>

      </div>
    </div>
  </div>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script>
  // https://stackoverflow.com/a/22790025
  function Get(yourUrl){
    var Httpreq = new XMLHttpRequest(); // a new request
    Httpreq.open("GET",yourUrl,false);
    Httpreq.send(null);
    return Httpreq.responseText;
  }

  function ready() {
    document.title = location.host + ' - ' + document.title;
    var json_obj = JSON.parse(Get("/frontends.json"));
    var ul = document.getElementById('sites');
    for (var key in json_obj) {
      if (key == 'cis') continue; // we already at this site
      var sites = json_obj[key];
      var sitesLength = sites.length;
      var port = "";
      if (location.port != '') port = ':' + location.port;
      for (var i = 0; i < sitesLength; i++) {
        var a = document.createElement('a');
        a.href = 'http://' + sites[i] + port + '/';
        a.innerHTML = key + ' (' + sites[i] + ')';
        a.setAttribute('target', '_blank');
        var li = document.createElement('li');
        li.appendChild(a);
        ul.appendChild(li);
      }
    }
  }
  document.addEventListener("DOMContentLoaded", ready);
</script>

</body>
</html>
